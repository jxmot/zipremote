<!DOCTYPE html>
<html>
<!--
    Author: https://github.com/jxmot
    Repository: https://github.com/jxmot/zipremote
-->
<head>
    <style type="text/css">
        body {width: auto;text-align:center;}
    </style>
    <script src="//code.jquery.com/jquery-3.6.0.min.js" type="text/javascript"></script>
</head>
<body>
    <div>
        <br>
        <p>
            A demonstration of using HTML/javascript to call the 
            API and retrieve a zip file.
        </p>
        <button id="button" type="button">Get a Zip File!</button> 
    </div>
    <div>
        <p id="results">
        </p>
    </div>
    <script type="text/javascript">
        function alldone(resp) {
            console.log(resp);
            $('#results').html(`The reponse was: ${JSON.stringify(resp)}`);
        };

        /*
            Send a GET request with arguments(optional) and
            invoke a callback function when completed.
        */
        function get(func, args, callback) {
            var _resp = {};
            var resp =  null;
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if(this.readyState == 4) {
                    resp = this.responseText;
                    resp = resp.replace(/[\n\r]/g, '');

                    console.log('get - ' + resp);

                    if(resp.match(/^\{/g)) _resp = JSON.parse(resp);
                    else _resp = resp;

                    callback(_resp);
                }
            };
            if((args === undefined) || (args === '')) {
                xmlhttp.open('GET', `./${func}.php`, true);
            } else {
                xmlhttp.open('GET', `./${func}.php${args}`, true);
            }
            xmlhttp.send();
        };

        // GET gsfapi.php?siteid=bigsite&key=key_goes_here&pathid=recur
        // Edit as needed...
        var siteid = 'bigsite';
        var key = 'key_goes_here';
        var pathid = 'plogs';
        var gsfargs = `?siteid=${siteid}&key=${key}&pathid=${pathid}`;

        $('#button').click(function() {
            $('#results').html('');
            get('gsfapi', gsfargs, alldone);
        });
    </script>
</body>
</html>